<!DOCTYPE html><style>
#test-container {
			position: relative;
			height: 40px;
		}
		#test1 {
			width: 40px;
			height: 40px;
			background: red;
			position: absolute;
		}
			#test2 {
			width: 40px;
			height: 40px;
			background: red;
			position: absolute;
		}
		</style>
	 <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
	 <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
<div class="row-fluid">
<div id="test-container" class="span6">
		<div id="test1"></div>
	</div>
	<div id="test-container" class="span6">
		<div id="test2"></div>
	</div>
</div>
	<div class="row-fluid"><button id="startit" class="btn" >download stuff</button></div>
<div class="row-fluid" id="buttons">
	<div class="span4">
		<button type="button" id="regular" class="btn">Download and transfer with structured clone</button>
		<div id="out1"></div>
	</div>
	<div class="span4">
		<button type="button" id="transferobj" class="btn">Download and transfer with transferable objects</button>
		<div id="out2"></div>
	</div>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"> </script>
<script>
function animateSquare() {
	var test1 = document.getElementById('test1'),
	test2 = document.getElementById('test2')
		start = Date.now();

	window.requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
                                   window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.setTimeout;

	function step() {
		var now = Date.now(),
			progress = now - start;

		if (progress > 5000) {
			progress = 0;
			start = now;
		}

		test1.style.left = (progress / 10) + "px";
test2.style.left = (progress / 10) + "px";
		requestAnimationFrame(step);
	}

	requestAnimationFrame(step);
}


animateSquare();
</script>
<script src="https://raw.github.com/tildeio/rsvp.js/master/browser/rsvp.js"></script>
<script src="https://raw.github.com/timrwood/moment/2.0.0/moment.js"></script>
<script src="communist.js"></script>
<script>
var wFunc=function(data,callback){
	var text = self.text;
	var ajax = function (url, cb) {
			var request = new XMLHttpRequest();
			request.open("GET", url);
				request.onreadystatechange = function() {
					if (request.readyState === 4 && request.status === 200) {
						cb(request.responseText);
						}
				};
			request.send();
		};
	if(data[0]==="s"){
		ajax(data[1],function(resp){	
			text = resp;
			callback(text.length);
		});
	}else if(data==="r"){
		if(text){
		callback(text);
		}else{
			callback("oh shit " + text);
		}
	}
};
var c = communist(wFunc);
$("#buttons").css("display","none");
var startButton = $("#startit");
startButton.on("click",function(){
startButton.addClass("disabled").html("loading...");
var starting = c.data(["s",communist.makeUrl("dictionary.txt")]);
starting.then(function(a){
	var reg;
	if(a>0){
		console.log(a);
		startButton.css("display","none");
		$("#buttons").css("display","block");
		reg = $("#regular");
		reg.on("click",function(){
			reg.addClass("disabled").html("transfering...");
			var t1 = moment();
			c.data("r").then(function(a){
				var t2 = moment();
				var nt = "transfered a string of length " + a.length + " took " + moment.duration(t2.diff(t1)).asSeconds() + " seconds, again?";
				console.log(nt);
				reg.removeClass("disabled").html(nt);
			},function(a){console.log(a)});
			
		});
	}
});
});


</script>