/*! communist 2013-03-18 */
(function(n){"use strict";function e(){return n.defer()}var t=function(){},r=function(n){var e,t=n.match(/(importScripts\(.*\);)/);return e=t?t[0].replace(/importScripts\((.*)\);?/,function(n,e){return e?"importScripts("+e.split(",").map(function(n){return'"'+l.makeUrl(n.slice(1,-1))+'"'})+");\n":""})+n.replace(/(importScripts\(.*\);?)/,"\n"):n},a=function(n){var e,t=r(n.join(""));if(l.URL=l.URL||window.URL||window.webkitURL||self.URL,window.communist.IEpath){try{e=new Worker(l.URL.createObjectURL(new Blob([t],{type:"text/javascript"})))}catch(a){e=new Worker(window.communist.IEpath),e.postMessage(t)}return e}return new Worker(l.URL.createObjectURL(new Blob([t],{type:"text/javascript"})))},u=function(n,t){var r=e(),u=a(["var _self={};\n_self.fun = ",n,";\n	_self.cb=function(data,transfer){\n			self.postMessage(data,transfer);\n			self.close();\n		};\n		_self.result = _self.fun(",JSON.stringify(t),',_self.cb);\n		if(typeof _self.result !== "undefined"){\n			_self.cb(_self.result);\n		}']);return u.onmessage=function(n){r.resolve(n.data)},u.onerror=function(n){n.preventDefault(),r.reject(n.message)},r.promise},f=function(n,e,r){var u=new t,f=a(["var _close=function(){self.close();};var _db={};\nvar _self={};\n_self.fun = ",n,';\n		_self.cb=function(data,transfer){\n			self.postMessage(data,transfer);\n		};\n		self.onmessage=function(e){\n		_self.result = _self.fun(e.data,_self.cb);\n			if(typeof _self.result !== "undefined"){\n				_self.cb(_self.result);\n			}\n		}']);return f.onmessage=function(n){e(n.data)},f.onerror=r?r:function(){e()},u.data=function(n,e){return f.postMessage(n,e),u},u.close=function(){return f.terminate()},u},o=function(n){var r=new t,a=[],u=function(n){"string"!=typeof n&&n.preventDefault&&(n.preventDefault(),n=n.message),a.forEach(function(e){e&&e.reject(n)})},o="function(data,cb){var _self={};_self.fun = "+n+';\n		_self.numberCB = function(num,d,tran){\n			cb([num,d],tran);\n		};\n		_self.boundCB = _self.numberCB.bind(null,data[0]);\n		_self.result = _self.fun(data[1],_self.boundCB);\n		if(typeof _self.result !== "undefined"){\n			_self.boundCB(_self.result);\n		}\n	}',c=function(n){a[n[0]].resolve(n[1]),a[n[0]]=0},s=f(o,c,u);return r.close=function(){s.close(),u("closed")},r.data=function(n,t){var r=a.length;return a[r]=e(),s.data([r,n],t),a[r].promise},r},c=function(n,e){var r=new t,a="function(dat,cb){ var fun = "+n+';\n		switch(dat[0]){\n			case "data":\n				if(!_db._r){\n					_db._r = dat[1];\n				}else{\n					_db._r = fun(_db._r,dat[1]);\n				}\n				break;\n			case "get":\n				return cb(_db._r);\n			case "close":\n				cb(_db._r);\n				_close();\n				break;\n		}\n	};',u=function(n){e(n)},o=f(a,u);return r.data=function(n,e){return o.data(["data",n],e),r},r.fetch=function(){return o.data(["get"]),r},r.close=function(n){n&&(e=function(){}),o.data(["close"])},r},s=function(n){function r(){for(var n=0,e=l.length;e>n&&i>0&&p>0;)i--,l[n].data(d.pop()),n++,p--;return s}function a(){o.close(),l.forEach(function(n){n.close()})}var u,o,s=new t,i=0,l=[],d=[],p=n,_=!1,m=!1,b={map:!1,reduce:!1,data:!1},v=function(){return b.map&&b.reduce&&b.data?r():s};return s.map=function(e,t){if(b.map)return s;for(var r=0;n>r;)(function(){var r,u=f(e,function(e){void 0!==typeof e&&o.data(e),i>0?(i--,r=d.pop(),t?u.data(r,[r]):u.data(r)):(p++,p===n&&(b.data=!1,m?a():_&&(_=!1,o.fetch())))});l.push(u)})(),r++;return b.map=!0,v()},s.reduce=function(n){return b.reduce?s:(o=c(n,function(n){u&&(u.resolve(n),u=!1)}),b.reduce=!0,v())},s.data=function(n){return m?void 0:(i+=n.length,d=d.concat(n),b.data=!0,v())},s.fetch=function(t){return u||(u=e()),n>p&&!t?_=!0:o.fetch(),u.promise},s.close=function(){return u||(u=e()),n>p?m=!0:a(),u.promise},s},i=function(n){function e(){return u.data&&u.map&&u.reduce?a.close():r}var r=new t,a=s(n),u={data:!1,map:!1,reduce:!1};return r.map=function(n,t){return u.map=!0,a.map(n,t),e()},r.reduce=function(n){return u.reduce=!0,a.reduce(n),e()},r.data=function(n){return u.data=!0,a.data(n),e()},r},l=function(n,e,t){return"number"!=typeof n&&"function"==typeof e?f(n,e,t):"number"!=typeof n?e?u(n,e):o(n):"number"==typeof n?e?s(n):i(n):void 0};l.reducer=c,l.worker=a,l.makeUrl=function(n){var e=document.createElement("link");return e.href=n,e.href},l.ajax=function(n,e,t){var r=t?"request.responseText":"JSON.parse(request.responseText)",a=e?"("+(""+e)+")("+r+",_cb)":r,u='function (url, _cb) {\n		var request = new XMLHttpRequest();\n		request.open("GET", url);\n			request.onreadystatechange = function() {\n				var _resp;\n				if (request.readyState === 4 && request.status === 200) {\n_resp = '+a+';\n					if(typeof _resp!=="undefined"){_cb(_resp);}\n					}\n			};\n		request.send();\n	}';return l(u,l.makeUrl(n))},window.communist=l})(RSVP);