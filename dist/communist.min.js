/*! communist 2013-03-24*/
/*!©2013 Calvin Metcalf @license MIT https://github.com/calvinmetcalf/communist */
/*!Includes Promiscuous ©2013 Ruben Verborgh @license MIT https://github.com/RubenVerborgh/promiscuous*/
(function(){"use strict";function n(){return i.deferred()}function e(n){var e,t=n.match(/(importScripts\(.*\);)/);return e=t?t[0].replace(/importScripts\((.*)\);?/,function(n,e){return e?"importScripts("+e.split(",").map(function(n){return'"'+i.makeUrl(n.slice(1,-1))+'"'})+");\n":""})+n.replace(/(importScripts\(.*\);?)/,"\n"):n}function t(n){var t,r=e(n.join(""));if(i.URL=i.URL||window.URL||window.webkitURL||self.URL,window.communist.IEpath){try{t=new Worker(i.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))}catch(u){t=new Worker(window.communist.IEpath),t.postMessage(r)}return t}return new Worker(i.URL.createObjectURL(new Blob([r],{type:"text/javascript"})))}function r(e,r){var u=n(),a=t(["var _self={};\n_self.fun = ",e,";\n	_self.cb=function(data,transfer){\n			self.postMessage(data,transfer);\n			self.close();\n		};\n		_self.result = _self.fun(",JSON.stringify(r),',_self.cb);\n		if(typeof _self.result !== "undefined"){\n			_self.cb(_self.result);\n		}']);return a.onmessage=function(n){u.resolve(n.data)},a.onerror=function(n){n.preventDefault(),u.reject(n.message)},u.promise}function u(n,e,r){var u=new l,a=t(["var _close=function(){self.close();};var _db={};\nvar _self={};\n_self.fun = ",n,';\n		_self.cb=function(data,transfer){\n			self.postMessage(data,transfer);\n		};\n		self.onmessage=function(e){\n		_self.result = _self.fun(e.data,_self.cb);\n			if(typeof _self.result !== "undefined"){\n				_self.cb(_self.result);\n			}\n		}']);return a.onmessage=function(n){e(n.data)},a.onerror=r?r:function(){e()},u.data=function(n,e){return a.postMessage(n,e),u},u.close=function(){return a.terminate()},u}function a(e){var t=new l,r=[],a=function(n){"string"!=typeof n&&n.preventDefault&&(n.preventDefault(),n=n.message),r.forEach(function(e){e&&e.reject(n)})},o="function(data,cb){_self.func = "+e+';\n		_self.numberCB = function(num,d,tran){\n			cb([num,d],tran);\n		};\n		_self.boundCB = _self.numberCB.bind(null,data[0]);\n		_self.result = _self.func(data[1],_self.boundCB);\n		if(typeof _self.result !== "undefined"){\n			_self.boundCB(_self.result);\n		}\n	}',c=function(n){r[n[0]].resolve(n[1]),r[n[0]]=0},f=u(o,c,a);return t.close=function(){f.close(),a("closed")},t.data=function(e,t){var u=r.length;return r[u]=n(),f.data([u,e],t),r[u].promise},t}function o(n,e){var t=new l,r="function(dat,cb){ var fun = "+n+';\n		switch(data[0]){\n			case "data":\n				if(!_db._r){\n					_db._r = dat[1];\n				}else{\n					_db._r = fun(_db._r,dat[1]);\n				}\n				break;\n			case "get":\n				return cb(_db._r);\n			case "close":\n				cb(_db._r);\n				_close();\n				break;\n		}\n	};',a=function(n){e(n)},o=u(r,a);return t.data=function(n,e){return o.data(["data",n],e),t},t.fetch=function(){return o.data(["get"]),t},t.close=function(n){n&&(e=function(){}),o.data(["close"])},t}function c(e){function t(){for(var n=0,e=i.length;e>n&&s>0&&p>0;)s--,i[n].data(d.pop()),n++,p--;return f}function r(){c.close(),i.forEach(function(n){n.close()})}var a,c,f=new l,s=0,i=[],d=[],p=e,_=!1,v=!1,m={map:!1,reduce:!1,data:!1},b=function(){return m.map&&m.reduce&&m.data?t():f};return f.map=function(n,t){if(m.map)return f;for(var a=0;e>a;)(function(){var a,o=u(n,function(n){void 0!==typeof n&&c.data(n),s>0?(s--,a=d.pop(),t?o.data(a,[a]):o.data(a)):(p++,p===e&&(m.data=!1,v?r():_&&(_=!1,c.fetch())))});i.push(o)})(),a++;return m.map=!0,b()},f.reduce=function(n){return m.reduce?f:(c=o(n,function(n){a&&(a.resolve(n),a=!1)}),m.reduce=!0,b())},f.data=function(n){return v?void 0:(s+=n.length,d=d.concat(n),m.data=!0,b())},f.fetch=function(t){return a||(a=n()),e>p&&!t?_=!0:c.fetch(),a.promise},f.close=function(){return a||(a=n()),e>p?v=!0:r(),a.promise},f}function f(n){function e(){return u.data&&u.map&&u.reduce?r.close():t}var t=new l,r=c(n),u={data:!1,map:!1,reduce:!1};return t.map=function(n,t){return u.map=!0,r.map(n,t),e()},t.reduce=function(n){return u.reduce=!0,r.reduce(n),e()},t.data=function(n){return u.data=!0,r.data(n),e()},t}function s(n){for(var e,t=new l,r=Object.keys(n),u=0,o=r.length,c="{",f=function(n){var e=Array.prototype.slice.call(arguments);return e.shift(),i.data([n,e])};o>u;)(function(u){e=r[u],0!==u&&(c+=","),c=c+e+":"+(""+n[e]),t[e]=f.bind(null,e)})(u),u++;c+="}";var s='function(data,cb){\n		var cont;\n		if(data[0]==="__start__"){\n			_self.obj = '+c+";\n			return true;\n		}\n		else{\n		cont =data[1];\n		cont.push(cb);\n		return _self.obj[data[0]].apply(null,cont);\n		}\n	}",i=a(s);return i.data(["__start__"]),t}function i(n,e,t){return"number"!=typeof n&&"function"==typeof e?u(n,e,t):"object"!=typeof n||Array.isArray(n)?"number"!=typeof n?e?r(n,e):a(n):"number"==typeof n?e?f(n):c(n):void 0:s(n)}(function(n){function e(){var n,o,c={then:function(e,t){return n(e,t)}};return function(){var f=[];n=function(n,t){var r=e();return f.push({d:r,resolve:n,reject:t}),r.promise},o=function(e,s,i){for(var l=0,d=f.length;d>l;l++){var p=f[l],_=p.d,v=p[e];typeof v!==u?_[e](s):r(v,s,_)}n=t(c,s,i),o=a}}(),{resolve:function(n){o("resolve",n,!0)},reject:function(n){o("reject",n,!1)},promise:c}}function t(n,t,a){return function(o,c){var f,s=a?o:c;return typeof s!==u?n:(setTimeout(r.bind(n,s,t,f=e())),f.promise)}}function r(n,e,t){try{var r=n(e);r&&typeof r.then===u?r.then(t.resolve,t.reject):t.resolve(r)}catch(a){t.reject(a)}}var u="function",a=function(){};n.resolve=function(n){var e={};return e.then=t(e,n,!0),e},n.reject=function(n){var e={};return e.then=t(e,n,!1),e},n.deferred=e})(i);var l=function(){};i.reducer=o,i.worker=t,i.makeUrl=function(n){var e=document.createElement("link");return e.href=n,e.href},i.ajax=function(n,e,t){var r=t?"request.responseText":"JSON.parse(request.responseText)",u=e?"("+(""+e)+")("+r+",_cb)":r,a='function (url, _cb) {\n		var request = new XMLHttpRequest();\n		request.open("GET", url);\n			request.onreadystatechange = function() {\n				var _resp;\n				if (request.readyState === 4 && request.status === 200) {\n_resp = '+u+';\n					if(typeof _resp!=="undefined"){_cb(_resp);}\n					}\n			};\n		request.send();\n	}';return i(a,i.makeUrl(n))},window.communist=i})();